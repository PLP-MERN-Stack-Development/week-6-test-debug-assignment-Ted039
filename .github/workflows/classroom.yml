name: Classroom Autograding

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  autograding:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ§ª Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install server dependencies
        working-directory: ./server
        run: npm install

      - name: ğŸ“¦ Install client dependencies
        working-directory: ./client
        run: npm install

      # ğŸ” Server and Backend Checks
      - name: âœ… Check if server.js exists
        run: test -f server/server.js

      - name: âœ… Check if MongoDB connection is configured
        run: grep -q "mongoose.connect" server/server.js || grep -r "mongoose.connect" server/

      - name: âœ… Check if Post model exists
        run: test -f server/src/models/Post.js

      - name: âœ… Check if User model exists
        run: test -f server/src/models/User.js

      - name: âœ… Check if API routes are defined
        run: grep -r "app.use.*\\/api\\/" server/

      # ğŸ” Client and Frontend Checks
      - name: âœ… Check if client App.jsx exists
        run: test -f client/src/App.jsx

      - name: âœ… Check for API service in client
        run: test -f client/src/services/api.js || test -f client/src/api.js

      - name: âœ… Check for React Router usage
        run: grep -q "react-router-dom" client/package.json

      - name: âœ… Check for React hooks usage
        run: grep -r -E "use(State|Effect|Context)" client/src/

      # ğŸ” Validation and Auth
      - name: âœ… Check for form validation usage
        run: grep -r -i -E "validation|validate|Joi|yup|validator" server/

      - name: âœ… Check for authentication implementation
        run: grep -r -i -E "auth|login|register|jwt|token|password" server/

      - name: âœ… Check for error handling in server
        run: grep -r -i -E "try.*catch|error.*handling|catch.*error" server/
